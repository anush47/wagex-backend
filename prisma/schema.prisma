// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  EMPLOYER
  EMPLOYEE
}

model Company {
  id        String   @id @default(uuid())
  name      String
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  users     User[]
  employees Employee[]

  @@map("companies")
}

model User {
  id        String   @id @default(uuid()) // Maps to Supabase Auth UID if possible, or internal UUID
  email     String   @unique
  
  nameWithInitials String?
  fullName         String?
  address          String?
  phone            String?

  role      Role     @default(EMPLOYEE)
  active    Boolean  @default(true)
  
  // Foreign Keys
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Employee {
  id         String   @id @default(uuid())
  employeeNo String
  name       String
  basicSalary Float   @default(0.0)
  status     String   @default("ACTIVE") // ACTIVE, INACTIVE, SUSPENDED

  // Foreign Keys
  companyId  String
  company    Company @relation(fields: [companyId], references: [id])

  // Future relations for Payroll, Attendance, etc.
  // payrolls Payroll[]
  // attendance Attendance[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([companyId, employeeNo]) // Employee No unique per company
  @@map("employees")
}

model AuditLog {
  id         String   @id @default(uuid())
  action     String   // CREATE, UPDATE, DELETE, PATCH
  resource   String   // User, Company, Employee
  resourceId String?  // ID of affected resource
  
  userId     String?  // Who performed the action (can be null if system)
  ipAddress  String?
  userAgent  String?

  details    Json?    // Store old/new values or diff

  createdAt  DateTime @default(now())

  @@map("audit_logs")
}
